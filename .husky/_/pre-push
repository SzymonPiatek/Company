echo "ğŸš€ Uruchamianie pre-push sprawdzeÅ„ przez test-manager..."

GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m' # No Color

run_test() {
  local name=$1
  local script=$2

  echo ""
  echo "ğŸ”µ Uruchamiam testy dla ${name}..."

  docker compose -f api/docker-compose.yml run --rm -T test-manager npm run "$script" > /dev/null 2>&1
  status=$?

  if [ $status -eq 0 ]; then
    echo "${GREEN}âœ… ${name} tests passed${NC}"
  else
    echo "${RED}âŒ ${name} tests failed${NC}"
    exit 1
  fi
}

run_check() {
  local name=$1
  local script=$2

  echo ""
  echo "ğŸ”µ Sprawdzam ${name}..."

  docker compose -f api/docker-compose.yml run --rm -T test-manager npm run "$script" > /dev/null 2>&1
  status=$?

  if [ $status -eq 0 ]; then
    echo "${GREEN}âœ… ${name} passed${NC}"
  else
    echo "${RED}âŒ ${name} failed${NC}"
    exit 1
  fi
}

run_check "Formatowanie kodu (Prettier)" "format:check"
run_check "Lintowanie kodu (ESLint)" "lint"

run_test "User Service" "test:user"
run_test "Resource Service" "test:resource"
run_test "Libs" "test:libs"

echo ""
echo "${GREEN}ğŸ† Wszystkie testy zakoÅ„czone pomyÅ›lnie! PushujÄ™.${NC}"
